<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Chinese Reading App</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Attach event listeners to all choice buttons
            $('.choice-button').on('click', async function(event) {
                const choice = $(this).data('choice');

                try {
                    const response = await fetch('/handle_click', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: new URLSearchParams({ 'char': choice }),
                    });

                    if (response.ok) {
                        const data = await response.json();
                        
                        // Update the page with the new game state
                        $('#pinyin').text('Pinyin: ' + data.pinyin.join(', '));
                        $('#english').text('English: ' + data.english.join(', '));
                        $('#reveal').text('Reveal: ' + data.reveal.join(' '));
                        document.querySelector('#incorrect-count').textContent = data.incorrect_count;
                        
                        // Check if the game is over
                        if (data.game_over) {
                            alert('Game over!');
                            // Optionally, handle game over logic
                        }
                    } else {
                        console.error('Error:', await response.text());
                    }
                } catch (error) {
                    console.error('Request failed', error);
                }
            });
        });
    </script>
</head>
<body>
    <h1>MCQ Game</h1>
    <p id="pinyin">Pinyin: {{ pinyin }}</p>
    <p id="english">English: {{ english }}</p>
    <p id="reveal">Reveal: {{ reveal|join(' ') }}</p>
    <p>Incorrect Answers: <span id="incorrect-count">{{ incorrect_count }}</span></p>
    <form id="game-form">
        {% for i in range(choices|length) %}
            <button type="button" class="choice-button" data-choice="{{ loop.index }}">
                {{ choiceMap[choices[i]] }}
            </button>
        {% endfor %}
    </form>
</body>
</html>
