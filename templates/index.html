<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Chinese Reading App</title>
</head>
<body>
    <h1>MCQ Game</h1>
    <p>Pinyin: {{ pinyin }}</p>
    <p>English: {{ english }}</p>
    <p>Reveal: {{ reveal|join(' ') }}</p>
    
    <form id="game-form">
        {% for i in range(choices|length) %}
            <button type="button" class="choice-button" data-choice="{{ choices[i] }}">{{ choiceMap[choices[i]] }}</button>
        {% endfor %}
    </form>

    <script>
        
        document.querySelectorAll('.choice-button').forEach(button => {
            button.addEventListener('click', async (event) => {
                const choice = button.getAttribute('data-choice');

                try {
                    const response = await fetch('/handle_click', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: new URLSearchParams({ 'char': choice }),
                    });

                    if (response.ok) {
                        const data = await response.json();
                        
                        // Update the page with the new state here
                        document.querySelector('p:nth-of-type(1)').textContent = 'Pinyin: ' + data.pinyin.join(', ');
                        document.querySelector('p:nth-of-type(2)').textContent = 'English: ' + data.english.join(', ');
                        document.querySelector('p:nth-of-type(3)').textContent = 'Reveal: ' + data.reveal.join(' ');

                        if (data.game_over) {
                            alert('Game over!');
                            // Optionally, handle game over logic
                        }
                    } else {
                        console.error('Error:', await response.text());
                    }
                } catch (error) {
                    console.error('Request failed', error);
                }
            });
        });
    </script>
</body>
</html>
